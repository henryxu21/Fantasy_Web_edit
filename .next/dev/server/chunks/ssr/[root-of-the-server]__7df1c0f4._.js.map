{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Downloads/fantasy-web-main%202/lib/store.ts"],"sourcesContent":["// lib/store.ts\n/* =========================================================\n   Blueprint Fantasy — Domain Store (STEP 1)\n   - User / Session（原样保留）\n   - Insight / Comment（原样可用）\n   - ✅ NEW: League Domain（不破坏旧逻辑）\n   ========================================================= */\n\nexport type User = {\n  id: string;\n  name: string;\n  email: string;\n  username: string;\n};\n\nexport type League = {\n  id: string;\n  slug: string;\n  name: string;\n  ownerId: string;\n  visibility: \"public\" | \"private\";\n  createdAt: number;\n};\n\nexport type Insight = {\n  id: string;\n  title: string;\n  body: string;\n  leagueSlug?: string; // legacy-compatible\n  author: string;\n  createdAt: number;\n  heat: number;\n};\n\nexport type Comment = {\n  id: string;\n  insightId: string;\n  author: string;\n  body: string;\n  createdAt: number;\n};\n\nconst KEYS = {\n  users: \"bp_users\",\n  session: \"bp_session\",\n  leagues: \"bp_leagues\",   // ✅ NEW\n  insights: \"bp_insights\",\n  comments: \"bp_comments\",\n};\n\n/* ------------------ Utils ------------------ */\n\nfunction safeParse<T>(raw: string | null, fallback: T): T {\n  if (!raw) return fallback;\n  try {\n    return JSON.parse(raw) as T;\n  } catch {\n    return fallback;\n  }\n}\n\nfunction uid(prefix = \"id\") {\n  return `${prefix}_${Math.random().toString(16).slice(2)}_${Date.now().toString(16)}`;\n}\n\nfunction canUseStorage() {\n  try {\n    if (typeof window === \"undefined\") return false;\n    const test = \"__storage_test__\";\n    window.localStorage.setItem(test, test);\n    window.localStorage.removeItem(test);\n    return true;\n  } catch {\n    return false;\n  }\n}\n\nfunction slugify(input: string) {\n  return input\n    .trim()\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, \"-\")\n    .replace(/^-+|-+$/g, \"\")\n    .slice(0, 40);\n}\n\n/* ------------------ Users & Session ------------------ */\n\ntype StoredUserRow = { user: any; password: string };\n\nfunction readUsers(): StoredUserRow[] {\n  if (!canUseStorage()) return [];\n  return safeParse(localStorage.getItem(KEYS.users), []);\n}\n\nfunction writeUsers(rows: StoredUserRow[]) {\n  if (!canUseStorage()) return;\n  localStorage.setItem(KEYS.users, JSON.stringify(rows));\n}\n\nfunction ensureUser(u: any): User {\n  return {\n    id: String(u?.id ?? uid(\"u\")),\n    name: String(u?.name ?? \"User\"),\n    email: String(u?.email ?? \"\"),\n    username: String(u?.username ?? \"user\"),\n  };\n}\n\nexport function getSessionUser(): User | null {\n  if (!canUseStorage()) return null;\n  const raw = localStorage.getItem(KEYS.session);\n  return raw ? ensureUser(JSON.parse(raw)) : null;\n}\n\nexport function signup(name: string, email: string, password: string) {\n  if (!canUseStorage()) return { ok: false as const, error: \"Storage unavailable\" };\n\n  const rows = readUsers();\n  if (rows.some(r => r.user.email === email)) {\n    return { ok: false as const, error: \"Email already exists\" };\n  }\n\n  const user: User = {\n    id: uid(\"u\"),\n    name,\n    email,\n    username: email.split(\"@\")[0],\n  };\n\n  rows.push({ user, password });\n  writeUsers(rows);\n  localStorage.setItem(KEYS.session, JSON.stringify(user));\n  return { ok: true as const, user };\n}\n\nexport function login(email: string, password: string) {\n  if (!canUseStorage()) return { ok: false as const, error: \"Storage unavailable\" };\n\n  const rows = readUsers();\n  const row = rows.find(r => r.user.email === email);\n  if (!row || row.password !== password) {\n    return { ok: false as const, error: \"Invalid credentials\" };\n  }\n\n  localStorage.setItem(KEYS.session, JSON.stringify(row.user));\n  return { ok: true as const, user: row.user };\n}\n\nexport function logout() {\n  if (!canUseStorage()) return;\n  localStorage.removeItem(KEYS.session);\n}\n\n/* ------------------ Leagues (NEW) ------------------ */\n\nexport function listLeagues(): League[] {\n  if (!canUseStorage()) return [];\n  return safeParse<League[]>(localStorage.getItem(KEYS.leagues), []);\n}\n\nexport function getLeagueBySlug(slug: string): League | null {\n  return listLeagues().find(l => l.slug === slug) ?? null;\n}\n\nexport function createLeague(input: {\n  name: string;\n  visibility: \"public\" | \"private\";\n}) {\n  if (!canUseStorage()) return { ok: false as const, error: \"Storage unavailable\" };\n\n  const user = getSessionUser();\n  if (!user) return { ok: false as const, error: \"Login required\" };\n\n  const league: League = {\n    id: uid(\"lg\"),\n    name: input.name.trim(),\n    slug: slugify(input.name),\n    ownerId: user.id,\n    visibility: input.visibility,\n    createdAt: Date.now(),\n  };\n\n  const all = listLeagues();\n  all.push(league);\n  localStorage.setItem(KEYS.leagues, JSON.stringify(all));\n\n  return { ok: true as const, league };\n}\n\n/* ------------------ Insights ------------------ */\nexport function getInsightById(id: string): Insight | null {\n  if (!canUseStorage()) return null;\n  const all = listInsights();\n  return all.find(i => i.id === id) ?? null;\n}\n\n\nexport function listInsights(): Insight[] {\n  if (!canUseStorage()) return [];\n  return safeParse<Insight[]>(localStorage.getItem(KEYS.insights), []);\n}\n\nexport function createInsight(input: {\n  title: string;\n  body: string;\n  leagueSlug?: string;\n}) {\n  if (!canUseStorage()) return { ok: false as const, error: \"Storage unavailable\" };\n\n  const user = getSessionUser();\n  if (!user) return { ok: false as const, error: \"Login required\" };\n\n  const insight: Insight = {\n    id: uid(\"ins\"),\n    title: input.title.trim(),\n    body: input.body.trim(),\n    leagueSlug: input.leagueSlug,\n    author: user.name,\n    createdAt: Date.now(),\n    heat: Math.floor(80 + Math.random() * 200),\n  };\n\n  const all = listInsights();\n  all.unshift(insight);\n  localStorage.setItem(KEYS.insights, JSON.stringify(all));\n\n  return { ok: true as const, insight };\n}\n\n/* ------------------ Comments ------------------ */\n\nexport function listComments(insightId: string): Comment[] {\n  if (!canUseStorage()) return [];\n  const all = safeParse<Comment[]>(localStorage.getItem(KEYS.comments), []);\n  return all.filter(c => c.insightId === insightId);\n}\n\nexport function addComment(insightId: string, body: string) {\n  if (!canUseStorage()) return { ok: false as const, error: \"Storage unavailable\" };\n\n  const user = getSessionUser();\n  if (!user) return { ok: false as const, error: \"Login required\" };\n\n  const all = safeParse<Comment[]>(localStorage.getItem(KEYS.comments), []);\n  const comment: Comment = {\n    id: uid(\"c\"),\n    insightId,\n    author: user.name,\n    body: body.trim(),\n    createdAt: Date.now(),\n  };\n\n  all.push(comment);\n  localStorage.setItem(KEYS.comments, JSON.stringify(all));\n\n  return { ok: true as const, comment };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 267, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Downloads/fantasy-web-main%202/app/auth/signup/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\nimport { signup } from \"@/lib/store\";\n\nexport default function SignupPage() {\n  const router = useRouter();\n  const [name, setName] = useState(\"\");\n  const [email, setEmail] = useState(\"\");\n  const [pw, setPw] = useState(\"\");\n  const [err, setErr] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  const canSubmit = name.trim().length >= 2 && email.includes(\"@\") && pw.length >= 6;\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!canSubmit || loading) return;\n\n    setLoading(true);\n    setErr(null);\n\n    const res = signup(name, email, pw);\n    if (!res.ok) {\n      setErr(res.error);\n      setLoading(false);\n      return;\n    }\n\n    router.push(\"/\");\n    router.refresh();\n  };\n\n  return (\n    <div className=\"lb-auth-page\">\n      <div className=\"lb-auth-card\">\n        <div className=\"lb-auth-header\">\n          <Link href=\"/\" className=\"lb-logo\" style={{ justifyContent: \"center\", marginBottom: 24 }}>\n            <div className=\"lb-logo-icon\">蓝</div>\n            <div className=\"lb-logo-text\">\n              <span className=\"lb-logo-title\">蓝本</span>\n              <span className=\"lb-logo-sub\">Fantasy 决策平台</span>\n            </div>\n          </Link>\n          <h1>创建账号</h1>\n          <p>开始记录你的 Fantasy 判断</p>\n        </div>\n\n        <form className=\"lb-form\" onSubmit={handleSubmit}>\n          <div className=\"lb-form-group\">\n            <label className=\"lb-form-label\">昵称</label>\n            <input\n              className=\"lb-form-input\"\n              type=\"text\"\n              value={name}\n              onChange={(e) => setName(e.target.value)}\n              placeholder=\"你的昵称\"\n              autoComplete=\"name\"\n            />\n          </div>\n\n          <div className=\"lb-form-group\">\n            <label className=\"lb-form-label\">邮箱</label>\n            <input\n              className=\"lb-form-input\"\n              type=\"email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              placeholder=\"you@example.com\"\n              autoComplete=\"email\"\n            />\n          </div>\n\n          <div className=\"lb-form-group\">\n            <label className=\"lb-form-label\">密码</label>\n            <input\n              className=\"lb-form-input\"\n              type=\"password\"\n              value={pw}\n              onChange={(e) => setPw(e.target.value)}\n              placeholder=\"至少6位字符\"\n              autoComplete=\"new-password\"\n            />\n          </div>\n\n          {err && <div className=\"lb-form-error\">{err}</div>}\n\n          <button\n            className=\"lb-form-submit\"\n            type=\"submit\"\n            disabled={!canSubmit || loading}\n          >\n            {loading ? \"创建中...\" : \"创建账号\"}\n          </button>\n        </form>\n\n        <div className=\"lb-auth-footer\">\n          已有账号？ <Link href=\"/auth/login\">立即登录</Link>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS;IACtB,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,IAAI,MAAM,GAAG,IAAA,iNAAQ,EAAC;IAC7B,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,iNAAQ,EAAgB;IAC9C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,MAAM,YAAY,KAAK,IAAI,GAAG,MAAM,IAAI,KAAK,MAAM,QAAQ,CAAC,QAAQ,GAAG,MAAM,IAAI;IAEjF,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,CAAC,aAAa,SAAS;QAE3B,WAAW;QACX,OAAO;QAEP,MAAM,MAAM,IAAA,sHAAM,EAAC,MAAM,OAAO;QAChC,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,OAAO,IAAI,KAAK;YAChB,WAAW;YACX;QACF;QAEA,OAAO,IAAI,CAAC;QACZ,OAAO,OAAO;IAChB;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAI,WAAU;;sCACb,8OAAC,uKAAI;4BAAC,MAAK;4BAAI,WAAU;4BAAU,OAAO;gCAAE,gBAAgB;gCAAU,cAAc;4BAAG;;8CACrF,8OAAC;oCAAI,WAAU;8CAAe;;;;;;8CAC9B,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAK,WAAU;sDAAgB;;;;;;sDAChC,8OAAC;4CAAK,WAAU;sDAAc;;;;;;;;;;;;;;;;;;sCAGlC,8OAAC;sCAAG;;;;;;sCACJ,8OAAC;sCAAE;;;;;;;;;;;;8BAGL,8OAAC;oBAAK,WAAU;oBAAU,UAAU;;sCAClC,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAM,WAAU;8CAAgB;;;;;;8CACjC,8OAAC;oCACC,WAAU;oCACV,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;oCACvC,aAAY;oCACZ,cAAa;;;;;;;;;;;;sCAIjB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAM,WAAU;8CAAgB;;;;;;8CACjC,8OAAC;oCACC,WAAU;oCACV,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;oCACxC,aAAY;oCACZ,cAAa;;;;;;;;;;;;sCAIjB,8OAAC;4BAAI,WAAU;;8CACb,8OAAC;oCAAM,WAAU;8CAAgB;;;;;;8CACjC,8OAAC;oCACC,WAAU;oCACV,MAAK;oCACL,OAAO;oCACP,UAAU,CAAC,IAAM,MAAM,EAAE,MAAM,CAAC,KAAK;oCACrC,aAAY;oCACZ,cAAa;;;;;;;;;;;;wBAIhB,qBAAO,8OAAC;4BAAI,WAAU;sCAAiB;;;;;;sCAExC,8OAAC;4BACC,WAAU;4BACV,MAAK;4BACL,UAAU,CAAC,aAAa;sCAEvB,UAAU,WAAW;;;;;;;;;;;;8BAI1B,8OAAC;oBAAI,WAAU;;wBAAiB;sCACxB,8OAAC,uKAAI;4BAAC,MAAK;sCAAc;;;;;;;;;;;;;;;;;;;;;;;AAKzC"}}]
}